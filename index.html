<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Tracker | Интимный дневник</title>
    <link rel="stylesheet" href="style.css">
    <style>
        </style>
</head>
<body>
    <div class="app-container">
        <header>
            <i class="fas fa-heart heart-icon"></i>
            <h1>Love Tracker</h1>
            <p class="subtitle">Дневник вашей интимной жизни</p>
        </header>
        
        <div class="main-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Этот месяц</div>
                    <div class="stat-value" id="thisMonth">0</div>
                    <div class="stat-label">дней</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Прошлый месяц</div>
                    <div class="stat-value" id="lastMonth">0</div>
                    <div class="stat-label">дней</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Эта неделя</div>
                    <div class="stat-value" id="thisWeek">0</div>
                    <div class="stat-label">дней</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">В среднем</div>
                    <div class="stat-value" id="avgPerWeek">0</div>
                    <div class="stat-label">в неделю</div>
                </div>
            </div>
            
            <div class="calendar-header">
                <div class="month-title" id="currentMonth"></div>
                <div class="nav-buttons">
                    <button class="nav-btn" id="prevMonthBtn"><i class="fas fa-chevron-left"></i></button>
                    <button class="nav-btn" id="nextMonthBtn"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            
            <div class="weekdays">
                <div>Пн</div>
                <div>Вт</div>
                <div>Ср</div>
                <div>Чт</div>
                <div>Пт</div>
                <div>Сб</div>
                <div>Вс</div>
            </div>
            
            <div class="calendar-grid" id="calendar"></div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" id="addBtn">
                    <i class="fas fa-plus"></i> Добавить сегодня
                </button>
                <button class="btn btn-outline" id="clearBtn">
                    <i class="fas fa-trash-alt"></i> Очистить
                </button>
            </div>
            
            <div class="streak-container" id="streakContainer" style="display: none;">
                <div class="streak-info">
                    <i class="fas fa-fire streak-icon"></i>
                    <div class="streak-details">
                        <h3>Текущая серия</h3>
                        <p>Дней подряд</p>
                    </div>
                </div>
                <div class="streak-count" id="streakCount">0</div>
            </div>
            
            <div class="notes-section">
                <div class="notes-title">
                    <i class="fas fa-book"></i> Ваши заметки
                </div>
                <textarea class="notes-textarea" id="notes" placeholder="Записывайте здесь ваши мысли, наблюдения или пожелания..."></textarea>
                <button class="btn btn-primary" id="saveNotesBtn" style="margin-top: 10px;">
                    <i class="fas fa-save"></i> Сохранить заметки
                </button>
            </div>
        </div>
    </div>

    <script>
        // Данные хранятся в localStorage
        let records = JSON.parse(localStorage.getItem('loveTrackerRecords')) || [];
        let notes = localStorage.getItem('loveTrackerNotes') || '';
        let currentDate = new Date();
        let displayedMonth = currentDate.getMonth();
        let displayedYear = currentDate.getFullYear();

        // Элементы DOM
        const calendarEl = document.getElementById('calendar');
        const currentMonthEl = document.getElementById('currentMonth');
        const thisMonthEl = document.getElementById('thisMonth');
        const lastMonthEl = document.getElementById('lastMonth');
        const thisWeekEl = document.getElementById('thisWeek');
        const avgPerWeekEl = document.getElementById('avgPerWeek');
        const notesEl = document.getElementById('notes');
        const addBtn = document.getElementById('addBtn');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');
        const saveNotesBtn = document.getElementById('saveNotesBtn');
        const clearBtn = document.getElementById('clearBtn');
        const streakContainer = document.getElementById('streakContainer');
        const streakCountEl = document.getElementById('streakCount');

        // Инициализация
        function init() {
            notesEl.value = notes;
            updateStats();
            renderCalendar();
            checkStreak();
            
            // Обработчики событий
            addBtn.addEventListener('click', addToday);
            prevMonthBtn.addEventListener('click', showPrevMonth);
            nextMonthBtn.addEventListener('click', showNextMonth);
            saveNotesBtn.addEventListener('click', saveNotes);
            clearBtn.addEventListener('click', confirmClear);
        }

        // Рендер календаря
        function renderCalendar() {
            calendarEl.innerHTML = '';
            
            // Установка заголовка месяца
            const monthNames = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь",
                              "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
            currentMonthEl.textContent = `${monthNames[displayedMonth]} ${displayedYear}`;
            
            // Получаем первый день месяца и сколько дней в месяце
            const firstDay = new Date(displayedYear, displayedMonth, 1);
            const daysInMonth = new Date(displayedYear, displayedMonth + 1, 0).getDate();
            
            // Получаем день недели первого дня (0 - воскресенье, 1 - понедельник и т.д.)
            let firstDayOfWeek = firstDay.getDay();
            if (firstDayOfWeek === 0) firstDayOfWeek = 7; // Делаем воскресенье 7-м днем
            
            // Добавляем пустые ячейки для дней из предыдущего месяца
            for (let i = 1; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarEl.appendChild(emptyDay);
            }
            
            // Добавляем дни месяца
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.textContent = day;
                
                // Проверяем, сегодня ли это день
                const thisDate = new Date(displayedYear, displayedMonth, day);
                if (thisDate.toDateString() === currentDate.toDateString()) {
                    dayEl.classList.add('today');
                }
                
                // Проверяем, есть ли запись на этот день
                const dateStr = formatDate(thisDate);
                if (records.includes(dateStr)) {
                    dayEl.classList.add('active');
                }
                
                // Добавляем обработчик клика
                dayEl.addEventListener('click', () => toggleDate(displayedYear, displayedMonth, day));
                
                calendarEl.appendChild(dayEl);
            }
        }

        // Переключение даты (добавление/удаление)
        function toggleDate(year, month, day) {
            const date = new Date(year, month, day);
            const dateStr = formatDate(date);
            
            if (records.includes(dateStr)) {
                records = records.filter(d => d !== dateStr);
            } else {
                records.push(dateStr);
            }
            
            saveRecords();
            updateStats();
            checkStreak();
            renderCalendar();
        }

        // Добавление сегодняшней даты
        function addToday() {
            const todayStr = formatDate(currentDate);
            
            if (!records.includes(todayStr)) {
                records.push(todayStr);
                saveRecords();
                updateStats();
                checkStreak();
                
                // Если показываем текущий месяц, обновляем календарь
                if (displayedMonth === currentDate.getMonth() && displayedYear === currentDate.getFullYear()) {
                    renderCalendar();
                }
                
                // Анимация "пульса" для кнопки
                addBtn.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    addBtn.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // Показать предыдущий месяц
        function showPrevMonth() {
            displayedMonth--;
            if (displayedMonth < 0) {
                displayedMonth = 11;
                displayedYear--;
            }
            renderCalendar();
        }

        // Показать следующий месяц
        function showNextMonth() {
            displayedMonth++;
            if (displayedMonth > 11) {
                displayedMonth = 0;
                displayedYear++;
            }
            renderCalendar();
        }

        // Сохранение заметок
        function saveNotes() {
            notes = notesEl.value;
            localStorage.setItem('loveTrackerNotes', notes);
            
            // Анимация подтверждения
            saveNotesBtn.innerHTML = '<i class="fas fa-check"></i> Сохранено!';
            setTimeout(() => {
                saveNotesBtn.innerHTML = '<i class="fas fa-save"></i> Сохранить заметки';
            }, 2000);
        }

        // Подтверждение очистки
        function confirmClear() {
            if (confirm('Вы действительно хотите очистить все данные? Это действие нельзя отменить.')) {
                clearData();
            }
        }

        // Очистка данных
        function clearData() {
            records = [];
            notes = '';
            localStorage.removeItem('loveTrackerRecords');
            localStorage.removeItem('loveTrackerNotes');
            notesEl.value = '';
            updateStats();
            checkStreak();
            renderCalendar();
        }

        // Проверка серии дней подряд
        function checkStreak() {
            if (records.length === 0) {
                streakContainer.style.display = 'none';
                return;
            }
            
            // Сортируем даты по возрастанию
            const sortedDates = records.map(d => new Date(d)).sort((a, b) => a - b);
            
            let currentStreak = 0;
            let yesterday = new Date(currentDate);
            yesterday.setDate(yesterday.getDate() - 1);
            
            // Проверяем есть ли сегодня или вчера запись
            const todayStr = formatDate(currentDate);
            const yesterdayStr = formatDate(yesterday);
            
            if (records.includes(todayStr)) {
                currentStreak = 1;
                // Идем назад по дням
                let prevDay = new Date(currentDate);
                for (let i = sortedDates.length - 1; i >= 0; i--) {
                    prevDay.setDate(prevDay.getDate() - 1);
                    const prevDayStr = formatDate(prevDay);
                    if (records.includes(prevDayStr)) {
                        currentStreak++;
                    } else {
                        break;
                    }
                }
            } else if (records.includes(yesterdayStr)) {
                currentStreak = 1;
                // Идем назад по дням
                let prevDay = new Date(yesterday);
                for (let i = sortedDates.length - 1; i >= 0; i--) {
                    prevDay.setDate(prevDay.getDate() - 1);
                    const prevDayStr = formatDate(prevDay);
                    if (records.includes(prevDayStr)) {
                        currentStreak++;
                    } else {
                        break;
                    }
                }
            }
            
            if (currentStreak > 1) {
                streakContainer.style.display = 'flex';
                streakCountEl.textContent = currentStreak;
            } else {
                streakContainer.style.display = 'none';
            }
        }

        // Обновление статистики
        function updateStats() {
            // Текущий месяц
            const thisMonthCount = records.filter(date => {
                const d = new Date(date);
                return d.getMonth() === currentDate.getMonth() && d.getFullYear() === currentDate.getFullYear();
            }).length;
            thisMonthEl.textContent = thisMonthCount;
            
            // Прошлый месяц
            const lastMonthDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
            const lastMonthCount = records.filter(date => {
                const d = new Date(date);
                return d.getMonth() === lastMonthDate.getMonth() && d.getFullYear() === lastMonthDate.getFullYear();
            }).length;
            lastMonthEl.textContent = lastMonthCount;
            
            // Текущая неделя
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const thisWeekCount = records.filter(date => {
                const d = new Date(date);
                return d >= weekAgo && d <= currentDate;
            }).length;
            thisWeekEl.textContent = thisWeekCount;
            
            // Среднее в неделю
            if (records.length > 0) {
                const firstDate = new Date(records[0]);
                const weeks = Math.max(1, Math.ceil((currentDate - firstDate) / (1000 * 60 * 60 * 24 * 7)));
                avgPerWeekEl.textContent = (records.length / weeks).toFixed(1);
            } else {
                avgPerWeekEl.textContent = '0';
            }
        }

        // Сохранение записей
        function saveRecords() {
            localStorage.setItem('loveTrackerRecords', JSON.stringify(records));
        }

        // Форматирование даты в YYYY-MM-DD
        function formatDate(date) {
            const d = new Date(date);
            let month = '' + (d.getMonth() + 1);
            let day = '' + d.getDate();
            const year = d.getFullYear();
            
            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;
            
            return [year, month, day].join('-');
        }

        // Запуск приложения
        init();
    </script>
</body>
</html>