<div class="app-container">
        <header>
            <i class="fas fa-heart heart-icon"></i>
            <h1>Love Tracker</h1>
            <p class="subtitle">Дневник ваших отношений</p>
        </header>
        
        <div class="main-content">
            <!-- Блок годовщины -->
            <div class="anniversary-container" id="anniversaryContainer">
                <div class="anniversary-title">
                    <i class="fas fa-heart"></i>
                    <span id="anniversaryTitle">Дата начала отношений</span>
                </div>
                <div class="anniversary-date" id="anniversaryDate">Не указана</div>
                <div class="days-counter" id="daysCounter">0</div>
                <div class="days-label">дней вместе</div>
                <button class="set-date-btn" id="setDateBtn">
                    <i class="fas fa-calendar-alt"></i> Указать дату
                </button>
            </div>
            
            <!-- Статистика -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Этот месяц</div>
                    <div class="stat-value" id="thisMonth">0</div>
                    <div class="stat-label">дней</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Прошлый месяц</div>
                    <div class="stat-value" id="lastMonth">0</div>
                    <div class="stat-label">дней</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Эта неделя</div>
                    <div class="stat-value" id="thisWeek">0</div>
                    <div class="stat-label">дней</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">В среднем</div>
                    <div class="stat-value" id="avgPerWeek">0</div>
                    <div class="stat-label">в неделю</div>
                </div>
            </div>
            
            <!-- Календарь интимной жизни -->
            <div class="calendar-header">
                <div class="month-title" id="currentMonth"></div>
                <div class="nav-buttons">
                    <button class="nav-btn" id="prevMonthBtn"><i class="fas fa-chevron-left"></i></button>
                    <button class="nav-btn" id="nextMonthBtn"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            
            <div class="weekdays">
                <div>Пн</div>
                <div>Вт</div>
                <div>Ср</div>
                <div>Чт</div>
                <div>Пт</div>
                <div>Сб</div>
                <div>Вс</div>
            </div>
            
            <div class="calendar-grid" id="calendar"></div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" id="addBtn">
                    <i class="fas fa-plus"></i> Добавить сегодня
                </button>
                <button class="btn btn-outline" id="clearBtn">
                    <i class="fas fa-trash-alt"></i> Очистить
                </button>
            </div>
            
            <!-- Заметки -->
            <div class="notes-section">
                <div class="notes-title">
                    <i class="fas fa-book"></i> Ваши заметки
                </div>
                <textarea class="notes-textarea" id="notes" placeholder="Записывайте здесь ваши мысли, наблюдения или пожелания..."></textarea>
                <button class="btn btn-primary" id="saveNotesBtn" style="margin-top: 10px;">
                    <i class="fas fa-save"></i> Сохранить заметки
                </button>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно выбора даты -->
    <div class="date-picker-modal" id="datePickerModal">
        <div class="date-picker-content">
            <div class="date-picker-title">Укажите дату начала отношений</div>
            <input type="date" class="date-input" id="dateInput">
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" id="saveDateBtn">Сохранить</button>
                <button class="modal-btn modal-btn-secondary" id="cancelDateBtn">Отмена</button>
            </div>
        </div>
    </div>

    <script>
        // Данные хранятся в localStorage
        let records = JSON.parse(localStorage.getItem('loveTrackerRecords')) || [];
        let notes = localStorage.getItem('loveTrackerNotes') || '';
        let anniversaryDate = localStorage.getItem('loveTrackerAnniversary');
        let currentDate = new Date();
        let displayedMonth = currentDate.getMonth();
        let displayedYear = currentDate.getFullYear();

        // Элементы DOM
        const elements = {
            // Блок годовщины
            anniversaryContainer: document.getElementById('anniversaryContainer'),
            anniversaryTitle: document.getElementById('anniversaryTitle'),
            anniversaryDate: document.getElementById('anniversaryDate'),
            daysCounter: document.getElementById('daysCounter'),
            setDateBtn: document.getElementById('setDateBtn'),
            
            // Модальное окно
            datePickerModal: document.getElementById('datePickerModal'),
            dateInput: document.getElementById('dateInput'),
            saveDateBtn: document.getElementById('saveDateBtn'),
            cancelDateBtn: document.getElementById('cancelDateBtn'),
            
            // Статистика
            thisMonth: document.getElementById('thisMonth'),
            lastMonth: document.getElementById('lastMonth'),
            thisWeek: document.getElementById('thisWeek'),
            avgPerWeek: document.getElementById('avgPerWeek'),
            
            // Календарь
            currentMonth: document.getElementById('currentMonth'),
            calendar: document.getElementById('calendar'),
            prevMonthBtn: document.getElementById('prevMonthBtn'),
            nextMonthBtn: document.getElementById('nextMonthBtn'),
            addBtn: document.getElementById('addBtn'),
            clearBtn: document.getElementById('clearBtn'),
            
            // Заметки
            notes: document.getElementById('notes'),
            saveNotesBtn: document.getElementById('saveNotesBtn')
        };

        // Инициализация приложения
        function init() {
            // Загрузка данных
            loadAnniversaryDate();
            loadNotes();
            updateStats();
            renderCalendar();
            
            // Настройка обработчиков событий
            setupEventListeners();
        }

        // Загрузка даты годовщины
        function loadAnniversaryDate() {
            if (anniversaryDate) {
                updateAnniversaryDisplay();
            }
        }
        
        // Обновление отображения годовщины
        function updateAnniversaryDisplay() {
            const startDate = new Date(anniversaryDate);
            const today = new Date();
            
            // Вычисляем количество дней
            const timeDiff = today - startDate;
            const daysTogether = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            
            // Форматируем дату для отображения
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = startDate.toLocaleDateString('ru-RU', options);
            
            // Обновляем интерфейс
            elements.anniversaryDate.textContent = formattedDate;
            elements.daysCounter.textContent = daysTogether;
            
            // Меняем заголовок после первого года
            if (daysTogether >= 365) {
                const years = Math.floor(daysTogether / 365);
                elements.anniversaryTitle.innerHTML = 
                    `<i class="fas fa-heart"></i> Вместе уже ${years} ${getYearsWord(years)}`;
            }
        }
        
        // Правильное склонение слова "год"
        function getYearsWord(years) {
            const lastDigit = years % 10;
            const lastTwoDigits = years % 100;
            
            if (lastTwoDigits >= 11 && lastTwoDigits <= 19) return 'лет';
            if (lastDigit === 1) return 'год';
            if (lastDigit >= 2 && lastDigit <= 4) return 'года';
            return 'лет';
        }

        // Показать модальное окно выбора даты
        function showDatePicker() {
            elements.datePickerModal.style.display = 'flex';
            elements.dateInput.value = anniversaryDate || '';
        }

        // Скрыть модальное окно
        function hideDatePicker() {
            elements.datePickerModal.style.display = 'none';
        }

        // Сохранить дату отношений
        function saveAnniversaryDate() {
            if (!elements.dateInput.value) {
                alert('Пожалуйста, выберите дату');
                return;
            }
            
            anniversaryDate = elements.dateInput.value;
            localStorage.setItem('loveTrackerAnniversary', anniversaryDate);
            updateAnniversaryDisplay();
            hideDatePicker();
            
            // Анимация подтверждения
            animateElement(elements.anniversaryContainer);
        }
        
        // Анимация элемента
        function animateElement(element) {
            element.style.transform = 'scale(1.05)';
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 300);
        }

        // Загрузка заметок
        function loadNotes() {
            elements.notes.value = notes;
        }
        
        // Сохранение заметок
        function saveNotes() {
            notes = elements.notes.value;
            localStorage.setItem('loveTrackerNotes', notes);
            
            // Анимация подтверждения
            elements.saveNotesBtn.innerHTML = '<i class="fas fa-check"></i> Сохранено!';
            setTimeout(() => {
                elements.saveNotesBtn.innerHTML = '<i class="fas fa-save"></i> Сохранить заметки';
            }, 2000);
        }

        // Рендер календаря
        function renderCalendar() {
            elements.calendar.innerHTML = '';
            
            // Установка заголовка месяца
            const monthNames = ["Январь", "Февраль", "Март", "Апрель", "Май", "Июнь",
                              "Июль", "Август", "Сентябрь", "Октябрь", "Ноябрь", "Декабрь"];
            elements.currentMonth.textContent = `${monthNames[displayedMonth]} ${displayedYear}`;
            
            // Получаем первый день месяца и сколько дней в месяце
            const firstDay = new Date(displayedYear, displayedMonth, 1);
            const daysInMonth = new Date(displayedYear, displayedMonth + 1, 0).getDate();
            
            // Получаем день недели первого дня
            let firstDayOfWeek = firstDay.getDay();
            if (firstDayOfWeek === 0) firstDayOfWeek = 7; // Делаем воскресенье 7-м днем
            
            // Добавляем пустые ячейки для дней из предыдущего месяца
            for (let i = 1; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                elements.calendar.appendChild(emptyDay);
            }
            
            // Добавляем дни месяца
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.textContent = day;
                
                // Проверяем, сегодня ли это день
                const thisDate = new Date(displayedYear, displayedMonth, day);
                if (thisDate.toDateString() === currentDate.toDateString()) {
                    dayEl.classList.add('today');
                }
                
                // Проверяем, есть ли запись на этот день
                const dateStr = formatDate(thisDate);
                if (records.includes(dateStr)) {
                    dayEl.classList.add('active');
                }
                
                // Добавляем обработчик клика
                dayEl.addEventListener('click', () => toggleDate(displayedYear, displayedMonth, day));
                
                elements.calendar.appendChild(dayEl);
            }
        }

        // Переключение даты (добавление/удаление)
        function toggleDate(year, month, day) {
            const date = new Date(year, month, day);
            const dateStr = formatDate(date);
            
            if (records.includes(dateStr)) {
                records = records.filter(d => d !== dateStr);
            } else {
                records.push(dateStr);
            }
            
            saveRecords();
            updateStats();
            renderCalendar();
        }

        // Добавление сегодняшней даты
        function addToday() {
            const todayStr = formatDate(currentDate);
            
            if (!records.includes(todayStr)) {
                records.push(todayStr);
                saveRecords();
                updateStats();
                renderCalendar();
                animateElement(elements.addBtn);
            }
        }

        // Показать предыдущий месяц
        function showPrevMonth() {
            displayedMonth--;
            if (displayedMonth < 0) {
                displayedMonth = 11;
                displayedYear--;
            }
            renderCalendar();
        }

        // Показать следующий месяц
        function showNextMonth() {
            displayedMonth++;
            if (displayedMonth > 11) {
                displayedMonth = 0;
                displayedYear++;
            }
            renderCalendar();
        }

        // Очистка данных
        function clearData() {
            if (confirm('Вы действительно хотите очистить все данные? Это действие нельзя отменить.')) {
                records = [];
                saveRecords();
                updateStats();
                renderCalendar();
            }
        }

        // Обновление статистики
        function updateStats() {
            // Текущий месяц
            const thisMonthCount = records.filter(date => {
                const d = new Date(date);
                return d.getMonth() === currentDate.getMonth() && d.getFullYear() === currentDate.getFullYear();
            }).length;
            elements.thisMonth.textContent = thisMonthCount;
            
            // Прошлый месяц
            const lastMonthDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
            const lastMonthCount = records.filter(date => {
                const d = new Date(date);
                return d.getMonth() === lastMonthDate.getMonth() && d.getFullYear() === lastMonthDate.getFullYear();
            }).length;
            elements.lastMonth.textContent = lastMonthCount;
            
            // Текущая неделя
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const thisWeekCount = records.filter(date => {
                const d = new Date(date);
                return d >= weekAgo && d <= currentDate;
            }).length;
            elements.thisWeek.textContent = thisWeekCount;
            
            // Среднее в неделю
            if (records.length > 0) {
                const firstDate = new Date(records[0]);
                const weeks = Math.max(1, Math.ceil((currentDate - firstDate) / (1000 * 60 * 60 * 24 * 7)));
                elements.avgPerWeek.textContent = (records.length / weeks).toFixed(1);
            } else {
                elements.avgPerWeek.textContent = '0';
            }
        }

        // Сохранение записей
        function saveRecords() {
            localStorage.setItem('loveTrackerRecords', JSON.stringify(records));
        }

        // Форматирование даты в YYYY-MM-DD
        function formatDate(date) {
            const d = new Date(date);
            let month = '' + (d.getMonth() + 1);
            let day = '' + d.getDate();
            const year = d.getFullYear();
            
            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;
            
            return [year, month, day].join('-');
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            // Годовщина
            elements.setDateBtn.addEventListener('click', showDatePicker);
            elements.saveDateBtn.addEventListener('click', saveAnniversaryDate);
            elements.cancelDateBtn.addEventListener('click', hideDatePicker);
            
            // Календарь
            elements.prevMonthBtn.addEventListener('click', showPrevMonth);
            elements.nextMonthBtn.addEventListener('click', showNextMonth);
            elements.addBtn.addEventListener('click', addToday);
            elements.clearBtn.addEventListener('click', clearData);
            
            // Заметки
            elements.saveNotesBtn.addEventListener('click', saveNotes);
        }

        // Запуск приложения после загрузки DOM
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
